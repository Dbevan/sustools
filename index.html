<!DOCTYPE html><html lang=en>
<title>Sundering Shadows Calendar Conversion</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css" rel="stylesheet">

<style>
	#dtInput {
		border: 1px solid black;
	}
</style>

<h1>Sundering Shadows Calendar Conversion</h1>

<form>
	<dl>
		<dt><label for=dtInput>OOC Date</label></dt>
		<dd><input type=datetime id=dtInput></dd>
	</dl>
</form>

<dl>
	<dt><label>Year</label></dt><dd id=year></dd>
	<dt><label>Month</label></dt><dd id=month></dd>
	<dt><label>Day</label></dt><dd id=day></dd>
	<dt><label>Hour</label></dt><dd id=hour></dd>
</dl>


<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
<script>
	flatpickr("#dtInput", {
		enableTime: true,
		dateFormat: "Y-m-d H:i",
	})
	
	dtInput.addEventListener('change', e => {
		console.log(e.target.value, e.target, new Date(e.target.value))
		output.value = convert_to_ic(new Date(e.target.value))
	})
	

	// The game epoch as a unix timestamp
	const epoch = new Date(720561600 * 1000)
	
	const epochDelta = 2736020387,
		secondsPerYear = 5760000,
		secondsPerMonth = 576000,
		secondsPerDay = 24000,
		secondsPerHour = 1200
	

	function convert_to_ic(when) {
		when += epochDelta

		year.innerText = Math.floor(when / secondsPerYear)
		month.innerText = Math.floor((when % secondsPerYear) / secondsPerMonth)
		day.innerText = Math.floor(((when % secondsPerYear) % secondsPerMonth) / secondsPerDay)
		hour.innerText = Math.floor((((when % secondsPerYear) % secondsPerMonth) % secondsPerDay) / secondsPerHour)
	}

	convert_to_ic((+new Date()) / 1000)
</script> 